(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Index"],{"2ab6":function(t,e,n){t.exports=n.p+"img/index-locate-fail.26764f19.gif"},"5fa4":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Page",{staticClass:"p-index",attrs:{header:!1,tabbar:"index"}},[i("div",[t.loaded?t._e():i("IndexSkeleton",{staticClass:"p-index__loading",attrs:{headerLoaded:t.locState>0,entriesLoaded:t.entriesLoaded,listLoaded:t.listLoaded}}),i("IndexHeader",{attrs:{"location-name":t.location.locationName,locating:0===t.locState,detecting:1===t.locState},on:{"click:address":t.chooseAddress}}),i("IndexSearch"),3!==t.locState?[t.entryGroupMap.main?i("IndexMainEntries",{attrs:{entries:t.entryGroupMap.main.entries}}):t._e(),i("div",{staticClass:"p-index__banner-mics-wrap"},[i("div",{staticClass:"p-index__activity-entries"},[i("div",{staticClass:"p-index__activity-entry",class:{"p-index__activity-entry_only":!t.favourEntries||!t.favourEntries.length}},[i("h3",{staticClass:"p-index__activity-entry-title"},[t._v("品质套餐")]),i("div",{staticClass:"p-index__activity-entry-desc"},[t._v("搭配齐全吃得好")]),i("div",{staticClass:"p-index__activity-entry-go"},[t._v("立即抢购 >")]),i("img",{attrs:{src:t.$getImage("dd416ff085900d62b8d60fa7e9c6b65dpng","?imageMogr/format/webp/thumbnail/!240x160r/gravity/Center/crop/240x160/"),alt:""}})]),t._l(t.favourEntries,function(e){return i("div",{key:e.id,staticClass:"p-index__activity-entry p-index__favour-entry"},[i("h3",{staticClass:"p-index__activity-entry-title"},[t._v(t._s(e.name))]),i("div",{staticClass:"p-index__activity-entry-desc"},[t._v(t._s(e.description))]),i("div",{staticClass:"p-index__activity-entry-go"},[i("span",{staticClass:"p-index__activity-entry-population"},[t._v(t._s(e.population))]),t._v(" 正在抢 >\n            ")]),i("img",{attrs:{src:t.$getImage(e.image_hash,t.favourImgParam),alt:""}})])})],2),i("IndexBanners",{attrs:{banners:t.bannerList}})],1),t.listLoaded?[i("div",{staticClass:"p-index__shoplist-title"},[t._v("推荐商家")]),i("IndexShopListFilter",{ref:"filter",attrs:{filterOptions:t.filterOptions},on:{submit:t.onSubmitFilters}}),i("IndexShopList",{ref:"infinite",attrs:{items:t.restaurantList,state:t.restaurantListState},on:{infinite:t.onInifiniteScroll}})]:t._e()]:t._e()],2),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.backTopVisible,expression:"backTopVisible"}],staticClass:"p-index__back-top",on:{click:t.onBackTop}},[i("img",{attrs:{src:n("e6d9"),alt:""}})])]),3===t.locState?i("div",{staticClass:"p-index__locate-fail"},[i("img",{attrs:{src:n("2ab6"),alt:""}}),i("h3",[t._v("输入地址后才能订餐哦！")]),i("button",{on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.chooseAddress(e)}}},[t._v("手动选择地址")])]):t._e()],1)},a=[],s=n("a322"),o=(n("7f7f"),n("ac6a"),n("c93e")),r=(n("cadf"),n("551c"),n("097d"),n("2f62")),d=n("408b"),c=n("8e17"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"shell"},[n("header",{staticClass:"shell__header",style:{visibility:t.headerLoaded?"hidden":"visible"}}),n("div",{staticClass:"shell__entries",style:{visibility:t.entriesLoaded?"hidden":"visible"}},[n("div",{staticClass:"shellAnimation b-index-entries__entries"},t._l(10,function(t){return n("div",{key:t,staticClass:"b-index-entries_entry"},[n("div",{staticClass:"b-index-entries_entry-icon"}),n("p",{staticClass:"b-index-entries_entry-title"})])}))]),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.listLoaded,expression:"!listLoaded"}],staticClass:"shell__list"})])},u=[],h={name:"IndexSkeleton",components:{},props:{headerLoaded:Boolean,entriesLoaded:Boolean,listLoaded:Boolean},data:function(){return{}},computed:{visible:function(){return!this.headerLoaded||!this.entriesLoaded||!this.listLoaded}}},f=h,p=(n("865f"),n("2877")),v=Object(p["a"])(f,l,u,!1,null,"4f886a19",null);v.options.__file="IndexSkeleton.vue";var m=v.exports,_=function(){return n.e("Index-deps").then(n.bind(null,"364c"))},b=function(){return n.e("Index-deps").then(n.bind(null,"6095"))},g=function(){return n.e("Index-deps").then(n.bind(null,"157a"))},x=function(){return n.e("Index-deps").then(n.bind(null,"4fb0"))},L=function(){return n.e("Index-deps").then(n.bind(null,"89c4"))},y=function(){return n.e("Index-deps").then(n.bind(null,"7cbe"))},I=function(){return n.e("Index-deps").then(n.bind(null,"1900"))},C=function(){return n.e("Index-deps").then(n.bind(null,"854e"))},S=function(){return n.e("Geohash").then(n.t.bind(null,"e02a",7))},w=function(){return n.e("ShopContainer").then(n.bind(null,"a06e"))},O=!1,k={name:"Index",components:{IndexSkeleton:m,IndexHeader:_,IndexSearch:b,IndexShopList:g,IndexMainEntries:x,IndexBanners:L,IndexShopListFilter:y,InfiniteScroll:C,IndexShopListItem:I},props:{},data:function(){return{entryGroupMap:{},bannerList:[],filterOptions:{},restaurantList:[],loaded:!1,locState:2,offset:0,rankId:"",filterPayload:null,selectAddressVisible:!1,backTopVisible:!1,entriesLoaded:!1,listLoaded:!1,restaurantListState:"loaded",favourImgParam:"?imageMogr/format/webp/thumbnail/!240x160r/gravity/Center/crop/240x160/",geohashChanged:!1}},computed:Object(o["a"])({},Object(r["e"])({location:function(t){return{longitude:t.longitude,latitude:t.latitude,geohash:t.geohash,locationName:t.locationName}}}),Object(r["e"])(["latitude","longitude","geohash","locationName"]),{favourEntries:function(){var t=(this.entryGroupMap["优惠专区类型"]||{}).entries;return t&&t.length?t.map(function(t){try{t.population=JSON.parse(t.more).population}catch(t){}return t}):t}}),watch:{geohash:function(t,e){t!==e&&(this.geohashChanged=!0)}},created:function(){var t=this;return O&&(window[this.$options.name]=this),O&&console.log("<Index> created"),this.loaded=!1,Promise.resolve().then(function(){return t.geohash?t.locationName?Promise.resolve().then(function(){t.locState=1}).then(function(){return new Promise(function(t){return setTimeout(t,2e3)})}).then(function(){return t.loadData()}):t.callPoi({latitude:t.latitude,longitude:t.longitude}):t.locate()}).then(function(){return new Promise(function(t){return setTimeout(t,1e3)})}).then(function(){t.loaded=!0,t.$emit("load")},function(){t.loaded=!0,t.$emit("load")}).then(function(){S(),w()})},activated:function(){O&&console.log("<Index> activated"),this.geohashChanged&&(this.geohashChanged=!1,this.onChangeAddress())},mounted:function(){var t=this;window.addEventListener("scroll",Object(c["a"])(function(){t.backTopVisible=window.scrollY>1800}),100)},updated:function(){this.$emit("updated:index",this.$data)},methods:Object(o["a"])({loadData:function(){var t=this;return this.locState=2,Promise.resolve().then(function(){t.fetchEntryList().then(function(){t.entriesLoaded=!0}),t.fetchBatchFilter().then(function(){t.listLoaded=!0}),t.fetchRestaurantList(),t.fetchBannerList()})},callPoi:function(t){var e=this;return this.locState=1,this.reverseGeoCoding(t).then(function(t){return t},function(t){return t}).then(function(){return e.loadData()})},locate:function(){var t=this;return this.locState=0,this.getCurrentPosition().then(function(e){var n=e.coords,i=n.latitude,a=n.longitude;return t.$store.commit("SAVE_LOCATION",{latitude:i,longitude:a,geohash:""}),t.callPoi(n)}).catch(function(){return S(),t.$store.commit("SET_LOCATION_NAME","未能获取地址"),Promise.resolve().then(function(){return new Promise(function(t){return setTimeout(t,2e3)})}).then(function(){return t.chooseAddress()}).then(function(){return new Promise(function(t){return setTimeout(t,800)})}).then(function(){t.locState=3})})},fetchEntryList:function(){var t=this;return Object(d["l"])({latitude:this.latitude,longitude:this.longitude}).then(function(e){t.entryGroupMap=e.reduce(function(t,e){return Object(o["a"])({},t,Object(s["a"])({},e.group_name,e))},{})})},fetchBannerList:function(){var t=this;return Object(d["b"])({latitude:this.latitude,longitude:this.longitude}).then(function(e){t.bannerList=e})},fetchBatchFilter:function(){var t=this;return Object(d["d"])({latitude:this.latitude,longitude:this.longitude}).then(function(e){t.filterOptions=e})},fetchRestaurantList:function(){var t=this;return this.restaurantListState="loading",Object(d["q"])(Object(o["a"])({latitude:this.latitude,longitude:this.longitude,offset:this.offset},this.filterPayload)).then(function(e){var n,i=e.items,a=e.rank_id;return 0===t.offset?t.restaurantList=i:t.restaurantList=t.restaurantList.concat(i),t.rankId=a,t.offset=t.restaurantList.length,n=t.offset?i.length?"loaded":"complete":"empty",t.restaurantListState=n}).catch(function(){return t.restaurantListState="loaded"})}},Object(r["b"])(["reverseGeoCoding","getCurrentPosition"]),{chooseAddress:function(){this.$router.push("/index/address")},onSubmitFilters:function(t){this.filterPayload=t,this.offset=0,this.restaurantList=[],this.restaurantListState="loaded",this.$refs.infinite.reset()},onInifiniteScroll:function(){O&&console.log("<Index> handle infinite event"),this.fetchRestaurantList()},onChangeAddress:function(){this.offset=0,this.restaurantList=[],this.restaurantListState="loaded",this.$refs.infinite&&this.$refs.infinite.reset(!1),this.loadData()},closeSelectAddress:function(){this.$router.back()},onBackTop:function(){document.documentElement.scrollTop=0}})},P=k,$=(n("aff2"),Object(p["a"])(P,i,a,!1,null,"7bc2805a",null));$.options.__file="Index.vue";var j=$.exports;n.d(e,"default",function(){return j})},"5fe0":function(t,e,n){},"865f":function(t,e,n){"use strict";var i=n("5fe0"),a=n.n(i);a.a},"9a2c":function(t,e,n){},aff2:function(t,e,n){"use strict";var i=n("9a2c"),a=n.n(i);a.a},e6d9:function(t,e,n){t.exports=n.p+"img/backtop.50da3c17.svg"}}]);
//# sourceMappingURL=Index.2987422b.js.map